{%load static%}
<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Dunyo Tour</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600&family=Roboto&display=swap" rel="stylesheet"> 

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Libraries Stylesheet -->
        <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet">
        <link href="{% static 'lib/lightbox/css/lightbox.min.css' %}" rel="stylesheet">


        <!-- Customized Bootstrap Stylesheet -->
        <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="{% static 'css/style.css' %}" rel="stylesheet">
        <style>
            /* Umumiy modal stillari */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0,0,0,0.4);
            }
        
            .modal-content {
                background-color: #fefefe;
                margin: 10% auto; /* Yuqoridan biroz pastroqda joylashsin */
                padding: 20px;
                border: 1px solid #888;
                width: 300px; /* Kichikroq karta uchun eni */
                border-radius: 10px;
                position: relative;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }
        
            .close-button {
                color: #aaa;
                position: absolute;
                top: 10px;
                right: 15px;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
            }
        
            .close-button:hover,
            .close-button:focus {
                color: black;
                text-decoration: none;
            }
        
            /* Profil karta stillari */
            .profile-card {
                text-align: center;
            }
        
            .profile-header {
                padding-bottom: 15px;
                border-bottom: 1px solid #eee;
                margin-bottom: 15px;
            }
        
            .profile-avatar {
                width: 80px;
                height: 80px;
                border-radius: 50%;
                background-color: #ddd;
                margin: 0 auto 10px;
                display: flex;
                justify-content: center;
                align-items: center;
            }
        
            .profile-avatar i {
                color: #666;
                font-size: 2.5em;
            }
        
            .profile-name {
                font-size: 1.5em;
                margin-bottom: 5px;
                color: #333;
            }
        
            .profile-status {
                color: #5cb85c;
                font-size: 0.9em;
            }
        
            .profile-status i {
                margin-right: 5px;
            }
        
            .profile-details {
                padding: 15px 0;
            }
        
            .detail-item {
                padding: 8px 0;
                border-bottom: 1px dotted #eee;
            }
        
            .detail-item:last-child {
                border-bottom: none;
            }
        
            .detail-label {
                font-weight: bold;
                color: #555;
            }
        
            .detail-value {
                color: #777;
            }
        
            .profile-actions {
                margin-top: 20px;
            }
        
            .action-button {
                background-color: #ffc107; /* Sariq rang */
                color: #333;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 0.9em;
                transition: background-color 0.3s ease;
            }
        
            .action-button:hover {
                background-color: #e0a800;
            }
        
            /* Tahrirlash formasi stillari */
            .edit-form {
                text-align: left;
            }
        
            .edit-form label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #333;
            }
        
            .edit-form input[type="number"],
            .edit-form input[type="text"] {
                width: 100%;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 4px;
                box-sizing: border-box;
                margin-bottom: 10px;
            }
        
            .edit-form button {
                background-color: #28a745;
                color: #fff;
                border: none;
                border-radius: 5px;
                padding: 10px 15px;
                cursor: pointer;
                font-size: 0.9em;
                transition: background-color 0.3s ease;
            }
        
            .edit-form button:hover {
                background-color: #1e7e34;
            }
            .profile-email {
                font-size: 0.9em;
                color: #777;
                margin-bottom: 10px;
            }
        </style>
    </head>

    <body>

        <!-- Spinner Start -->
        <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->

        <!-- Topbar Start -->
        <div class="container-fluid bg-primary px-5 d-none d-lg-block">
            <div class="row gx-0">
                <div class="col-lg-8 text-center text-lg-start mb-2 mb-lg-0">
                    <div class="d-inline-flex align-items-center" style="height: 45px;">
                        <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href=""><i class="fab fa-twitter fw-normal"></i></a>
                        <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href=""><i class="fab fa-facebook-f fw-normal"></i></a>
                        <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href=""><i class="fab fa-linkedin-in fw-normal"></i></a>
                        <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href=""><i class="fab fa-instagram fw-normal"></i></a>
                        <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle" href=""><i class="fab fa-youtube fw-normal"></i></a>
                    </div>
                </div>
                <div class="col-lg-4 text-center text-lg-end">
                    <div class="d-inline-flex align-items-center" style="height: 45px;">
                        {% if not user.is_authenticated %}
                        <a href="{%url 'register'%}"><small class="me-3 text-light"><i class="fa fa-user me-2"></i>Ro'yxatdan o'tish</small></a>
                        <a href="{%url 'login'%}"><small class="me-3 text-light"><i class="fa fa-sign-in-alt me-2"></i>Kirish</small></a>
                        {%endif%}
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle text-light" data-bs-toggle="dropdown"><small><i class="fa fa-home me-2"></i>Uy</small></a>
                            <div class="dropdown-menu rounded">
                                <a href="#" class="dropdown-item" id="showProfileModal"><i class="fas fa-user-alt me-2"></i>Mening profilim</a>
                                <a href="{%url 'logout'%}" class="dropdown-item"><i class="fas fa-power-off me-2"></i>Chiqish</a>
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Topbar End -->

        <!-- Navbar & Hero Start -->
        <div class="container-fluid position-relative p-0">
            <nav class="navbar navbar-expand-lg navbar-light px-4 px-lg-5 py-3 py-lg-0">
                <a href="" class="navbar-brand p-0">
                    <h1 class="m-0"><i class="fa fa-map-marker-alt me-3"></i>Dunyo Tour</h1>
                    <!-- <img src="img/logo.png" alt="Logo"> -->
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                    <span class="fa fa-bars"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <div class="navbar-nav ms-auto py-0">
                        <a href="{%url 'home'%}" class="nav-item nav-link">Bosh sahifa</a>
                        <a href="{%url 'tours'%}" class="nav-item nav-link">Ekskursiyalar</a>
                        <a href="{%url 'destination'%}" class="nav-item nav-link">Shaharlar</a>
                        <a href="{%url 'countrys'%}" class="nav-item nav-link">Davlatlar</a>
                        <a href="{%url 'gallery'%}" class="nav-item nav-link active">Galeriya</a>
                        <a href="contact.html" class="nav-item nav-link">Bog'lanish</a>
                    </div>
                    {%if user.is_authenticated%}
                    <a href="" class="btn btn-primary rounded-pill py-2 px-4 ms-lg-4">{{user.username}}</a>
                    {%endif%}
                </div>
            </nav>
        </div>
        <!-- Navbar & Hero End -->

        <!-- Header Start -->
        <div class="container-fluid bg-breadcrumb" style="background-image: url('{% static "img/packages-2.jpg" %}'); background-size: cover; background-repeat: no-repeat;">
            <div class="container text-center py-5" style="max-width: 900px;">
                <h3 class="text-white display-3 mb-4">Turlar</h1>
                {% comment %} <ol class="breadcrumb justify-content-center mb-0">
                    <li class="breadcrumb-item"><a href="{%url 'home'%}">Bosh sahifa</a></li>
                    <li class="breadcrumb-item"><a href="#">Turlar</a></li>
                </ol>     {% endcomment %}
            </div>
        </div>
        <!-- Header End -->

        <!-- Explore Tour Start -->
        <div class="container-fluid ExploreTour py-5">
            <div class="container py-5">
                <div class="mx-auto text-center mb-5" style="max-width: 900px;">
                    {% comment %} <h5 class="section-title px-3">Explore Tour</h5> {% endcomment %}
                    <h1 class="mb-4">Dunyo</h1>
                    <p class="mb-0">"Dunyoni sayohat qilish — bu har bir qadamda yangi madaniyatlarni kashf qilish, har bir manzilda o'zingizni yangidan topish va hayotga boshqacha nigoh bilan qarashdir. Chunki sayohat inson qalbini boyitadi, xotiralarni chiroyli lahzalarga aylantiradi va har bir burchakda hayotning mo'jizalarini ko'rsatadi."
                    </p>
                </div>
                <!-- Faqat rasmni ko'rsatish -->
                <div class="row g-4">
                    {% for i in gallery %}
                    <div class="col-md-6 col-lg-4 d-flex">
                        <div class="card border-0 shadow-sm w-100 h-100 overflow-hidden position-relative rounded-4">
                            <!-- Rasm -->
                            <img src="{{ i.image.url }}"
                                class="card-img-top w-100"
                                style="height: 250px; object-fit: cover;"
                                alt="{{ i.name }}">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <!-- Faqat rasmni ko'rsatish -->
            </div>
        </div>
        <!-- Explore Tour Start -->

        <!-- Subscribe Start -->
        {% comment %} <div class="container-fluid subscribe py-5">
            <div class="container text-center py-5">
                <div class="mx-auto text-center" style="max-width: 900px;">
                    <h5 class="subscribe-title px-3">Subscribe</h5>
                    <h1 class="text-white mb-4">Our Newsletter</h1>
                    <p class="text-white mb-5">Lorem ipsum dolor sit amet consectetur adipisicing elit. Laborum tempore nam, architecto doloremque velit explicabo? Voluptate sunt eveniet fuga eligendi! Expedita laudantium fugiat corrupti eum cum repellat a laborum quasi.
                    </p>
                    <div class="position-relative mx-auto">
                        <input class="form-control border-primary rounded-pill w-100 py-3 ps-4 pe-5" type="text" placeholder="Your email">
                        <button type="button" class="btn btn-primary rounded-pill position-absolute top-0 end-0 py-2 px-4 mt-2 me-2">Subscribe</button>
                    </div>
                </div>
            </div>
        </div> {% endcomment %}
        <!-- Subscribe End -->

        <!-- Footer Start -->
        <div class="container-fluid footer py-5">
            <div class="container py-5">
                <div class="row g-5">
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="mb-4 text-white">Biz haqimiza</h4>
                            <a href=""><i class="fas fa-home me-2"></i> O'zbekiston, Toshkent</a>
                            <a href=""><i class="fas fa-envelope me-2"></i>azizbekilyosov1212@gmail.com</a>
                            <a href=""><i class="fas fa-phone me-2"></i> (+998) 99- 876 54 32</a>
                            <a href="" class="mb-3"><i class="fas fa-print me-2"></i> (+998) 90- 876 54 32</a>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-share fa-2x text-white me-2"></i>
                                <a class="btn-square btn btn-primary rounded-circle mx-1" href=""><i class="fab fa-facebook-f"></i></a>
                                <a class="btn-square btn btn-primary rounded-circle mx-1" href=""><i class="fab fa-twitter"></i></a>
                                <a class="btn-square btn btn-primary rounded-circle mx-1" href=""><i class="fab fa-instagram"></i></a>
                                <a class="btn-square btn btn-primary rounded-circle mx-1" href=""><i class="fab fa-linkedin-in"></i></a>
                            </div>
                        </div>
                    </div>
                    {% comment %} <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="mb-4 text-white">Company</h4>
                            <a href=""><i class="fas fa-angle-right me-2"></i> About</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Careers</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Blog</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Press</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Gift Cards</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Magazine</a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="mb-4 text-white">Support</h4>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Contact</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Legal Notice</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Privacy Policy</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Terms and Conditions</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Sitemap</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Cookie policy</a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item">
                            <div class="row gy-3 gx-2 mb-4">
                                <div class="col-xl-6">
                                    <form>
                                        <div class="form-floating">
                                            <select class="form-select bg-dark border" id="select1">
                                                <option value="1">Arabic</option>
                                                <option value="2">German</option>
                                                <option value="3">Greek</option>
                                                <option value="3">New York</option>
                                            </select>
                                            <label for="select1">English</label>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-xl-6">
                                    <form>
                                        <div class="form-floating">
                                            <select class="form-select bg-dark border" id="select1">
                                                <option value="1">USD</option>
                                                <option value="2">EUR</option>
                                                <option value="3">INR</option>
                                                <option value="3">GBP</option>
                                            </select>
                                            <label for="select1">$</label>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <h4 class="text-white mb-3">Payments</h4>
                            <div class="footer-bank-card">
                                <a href="#" class="text-white me-2"><i class="fab fa-cc-amex fa-2x"></i></a>
                                <a href="#" class="text-white me-2"><i class="fab fa-cc-visa fa-2x"></i></a>
                                <a href="#" class="text-white me-2"><i class="fas fa-credit-card fa-2x"></i></a>
                                <a href="#" class="text-white me-2"><i class="fab fa-cc-mastercard fa-2x"></i></a>
                                <a href="#" class="text-white me-2"><i class="fab fa-cc-paypal fa-2x"></i></a>
                                <a href="#" class="text-white"><i class="fab fa-cc-discover fa-2x"></i></a>
                            </div>
                        </div>
                    </div> {% endcomment %}
                </div>
            </div>
        </div>
        <!-- Footer End -->
        
        <!-- Copyright Start -->
        <div class="container-fluid copyright text-body py-4">
            <div class="container">
                <div class="row g-4 align-items-center">
                    <div class="col-md-6 text-center text-md-end mb-md-0">
                        <i class="fas fa-copyright me-2"></i><a class="text-white" href="#">Your Site Name</a>, All right reserved.
                    </div>
                    <div class="col-md-6 text-center text-md-start">
                        <!--/*** This template is free as long as you keep the below author’s credit link/attribution link/backlink. ***/-->
                        <!--/*** If you'd like to use the template without the below author’s credit link/attribution link/backlink, ***/-->
                        <!--/*** you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". ***/-->
                        Designed By <a class="text-white" href="https://htmlcodex.com">HTML Codex</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Copyright End -->

        <!-- Back to Top -->
        <a href="#" class="btn btn-primary btn-primary-outline-0 btn-md-square back-to-top"><i class="fa fa-arrow-up"></i></a>   

        
        <!-- JavaScript Libraries -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{% static 'lib/easing/easing.min.js' %}"></script>
        <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
        <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
        <script src="{% static 'lib/lightbox/js/lightbox.min.js' %}"></script>
        

        <!-- Template Javascript -->
        <script src="{% static 'js/main.js'%}"></script>
        <div id="profileModal" class="modal">
            <div class="modal-content profile-card">
                <span class="close-button">&times;</span>
                <div class="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user fa-3x"></i>
                    </div>
                    <h3 class="profile-name">{{ user.username }}</h3>
                    <p class="profile-email">{{ user.email }}</p>
                    {% comment %} <span class="profile-status"><i class="fas fa-check-circle"></i> Foydalanuvchi obunaga ega</span> {% endcomment %}
                </div>
                <div class="profile-details">
                    <div class="detail-item">
                        <span class="detail-label">Telefon:</span>
                        <span class="detail-value" id="profil_telefon_card">{% if user.userprofile.telefon_raqami %}{{ user.userprofile.telefon_raqami }}{% else %}Yo'q{% endif %}</span>
                        <div class="detail-item">
                            <span class="detail-label">Yosh:</span>
                            <span class="detail-value" id="profil_yosh_card">{% if user.userprofile.yosh %}{{ user.userprofile.yosh }}{% else %}Ma'lumot yo'q{% endif %}</span>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button class="action-button edit-button" id="editProfileBtn"><i class="fas fa-edit"></i> Tahrirlash</button>
                        {% comment %} <button class="action-button message-button"><i class="fas fa-envelope"></i> Xabar</button>
                        <button class="action-button settings-button"><i class="fas fa-cog"></i> Sozlamalar</button> {% endcomment %}
                    </div>
                </div>
            </div>
        </div>
    
        <div id="editModal" class="modal">
            <div class="modal-content edit-form">
                <span class="close-button">&times;</span>
                <h2>Profilni tahrirlash</h2>
                <label for="yosh_edit">Yosh:</label>
                <input type="number" id="yosh_edit" name="yosh">
    
                <label for="telefon_edit">Telefon raqami:</label>
                <input type="text" id="telefon_edit" name="telefon">
    
                <button type="button" id="saqlash_edit">Saqlash</button>
            </div>
        </div>
    
        <script>
            // Modal oynalarni boshqarish uchun JavaScript
            const profileModal = document.getElementById("profileModal");
            const showProfileModalBtn = document.getElementById("showProfileModal");
            const closeButtons = document.querySelectorAll(".close-button");
            const editProfileBtn = document.getElementById("editProfileBtn");
            const editModal = document.getElementById("editModal");
            const saqlashEditBtn = document.getElementById("saqlash_edit");
            const yoshEditInput = document.getElementById("yosh_edit");
            const telefonEditInput = document.getElementById("telefon_edit");
            const profilTelefonCard = document.getElementById("profil_telefon_card");
    
            showProfileModalBtn.addEventListener("click", function() {
                profileModal.style.display = "block";
            });
    
            closeButtons.forEach(button => {
                button.addEventListener("click", function() {
                    profileModal.style.display = "none";
                    editModal.style.display = "none";
                });
            });
    
            window.addEventListener("click", function(event) {
                if (event.target == profileModal || event.target == editModal) {
                    profileModal.style.display = "none";
                    editModal.style.display = "none";
                }
            });
    
            editProfileBtn.addEventListener("click", function() {
                profileModal.style.display = "none";
                editModal.style.display = "block";
                // Agar foydalanuvchida telefon raqami bo'lsa, tahrirlash formasiga joylash
                if (profilTelefonCard.textContent !== "Yo'q") {
                    telefonEditInput.value = profilTelefonCard.textContent;
                    // Agar yosh ham bo'lsa, uni ham joylashtirish mumkin
                    // Masalan: yoshEditInput.value = document.getElementById("profil_yosh_card").textContent;
                }
            });
    
            saqlashEditBtn.addEventListener("click", function() {
                const yosh = yoshEditInput.value;
                const telefon = telefonEditInput.value;
    
                const formData = new FormData();
                formData.append('yosh', yosh);
                formData.append('telefon_raqami', telefon); // Modelda telefon_raqami deb nomlangan
    
                fetch("{% url 'profile' %}", {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Muvaffaqiyat:', data);
                    if (data.success) {
                        if (telefon) {
                            profilTelefonCard.textContent = telefon;
                        }
                        // Yoshni ham yangilash (agar profil kartada ko'rsatilgan bo'lsa)
                        const profilYoshCard = document.getElementById("profil_yosh_card");
                        if (profilYoshCard && yosh) {
                            profilYoshCard.textContent = yosh;
                        }
                        editModal.style.display = "none";
                        profileModal.style.display = "block";
                    } else if (data.error) {
                        console.error('Xatolik:', data.error);
                        alert('Ma\'lumotlarni saqlashda xatolik yuz berdi.');
                    }
                })
                .catch((error) => {
                    console.error('Tarmoq xatoligi:', error);
                    alert('Tarmoq xatoligi yuz berdi.');
                });
            });
        </script>
    </body>

</html>